<!DOCTYPE html>
<html>

<head>
    <title>Distance Matrix service</title>
</head>

<body>
    <div id="output"></div>
    <script>
  // the data from store api
      var storeListFromApi = [{
          storeId: 1,
          storeName: "VTEC Coffee สาขาเอกมัย",
          storeAddress1: "346/24 ถนนสุขุมวิท ",
          storeAddress2: "แขวงพระโขนง เขตคลองเตย กรุงเทพมหานคร 10110",
          storeAddress3: "",
          storePhoneNo: "02-863-2345",
          storeRemark: "",
          storeLatitude: 13.7207,
          storeLongitude: 100.586,
          storeImg0: "Store-1-0.png",
          storeImg1: "Store-1-1.png",
          storeImg2: "Store-1-2.png",
          storeImg3: "Store-1-3.png",
          storeImg4: "Store-1-4.png",
          storeImg5: "Store-1-5.png",
          storeImg6: "Store-1-6.png",
          storeImg7: "",
          storeImg8: "",
          storeImg9: "",
          storeImg10: ""
        },
        {
          storeId: 2,
          storeName: "VTEC Coffee สาขารามอินทรา",
          storeAddress1: " เลขที่ 109/9 หมู่ที่ 87 ถนนรามอินทรา",
          storeAddress2: "แขวงอนุสาวรีย์ เขตบางเขน กรุงเทพฯ 10220",
          storeAddress3: "",
          storePhoneNo: "02-782-4567",
          storeRemark: "",
          storeLatitude: 13.8694,
          storeLongitude: 100.6064,
          storeImg0: "Store-2-0.png",
          storeImg1: "Store-2-1.png",
          storeImg2: "Store-2-2.png",
          storeImg3: "Store-2-3.png",
          storeImg4: "Store-2-4.png",
          storeImg5: "Store-2-5.png",
          storeImg6: "",
          storeImg7: "",
          storeImg8: "",
          storeImg9: "",
          storeImg10: ""
        },
        {
          storeId: 3,
          storeName: "VTEC Coffee สาขาวังทองหลาง",
          storeAddress1: "เลขที่ 878 ซ.รามคำแหง 21 (นวศรี) ",
          storeAddress2: "ต.วังทองหลาง อ.วังทองหลาง กรุงเทพมหานค 10310",
          storeAddress3: "",
          storePhoneNo: "02-185-4354",
          storeRemark: "",
          storeLatitude: 13.7602,
          storeLongitude: 100.6013,
          storeImg0: "Store-3-0.png",
          storeImg1: "Store-3-1.png",
          storeImg2: "Store-3-2.png",
          storeImg3: "Store-3-3.png",
          storeImg4: "Store-3-4.png",
          storeImg5: "Store-3-5.png",
          storeImg6: "",
          storeImg7: "",
          storeImg8: "",
          storeImg9: "",
          storeImg10: ""
        },
        {
          storeId: 4,
          storeName: "VTEC Coffee สาขาห้าแยกลาดพร้าว",
          storeAddress1: "1130/6-7ถนนวิภาวดีรังสิต (ห้าแยกลาดพร้าว ตรงข้ามยูเนี่ยนมอลล์)",
          storeAddress2: "ลาดยาว , จตุจักร , กรุงเทพมหานคร 10900 ",
          storeAddress3: "",
          storePhoneNo: "02-939-6535",
          storeRemark: "",
          storeLatitude: 13.8109,
          storeLongitude: 100.5586,
          storeImg0: "Store-4-0.png",
          storeImg1: "Store-4-1.png",
          storeImg2: "",
          storeImg3: "",
          storeImg4: "",
          storeImg5: "",
          storeImg6: "",
          storeImg7: "",
          storeImg8: "",
          storeImg9: "",
          storeImg10: ""
        },
        {
          storeId: 5,
          storeName: "VTEC Coffee สาขาหาดใหญ่",
          storeAddress1: "152-156 ถ. นิพัทธ์อุทิศ 2",
          storeAddress2: "อ.หาดใหญ่ จ.สงขลา 90110",
          storeAddress3: "",
          storePhoneNo: "074-235-234",
          storeRemark: "",
          storeLatitude: 7.0083,
          storeLongitude: 100.4696,
          storeImg0: "Store-5-0.png",
          storeImg1: "",
          storeImg2: "",
          storeImg3: "",
          storeImg4: "",
          storeImg5: "",
          storeImg6: "",
          storeImg7: "",
          storeImg8: "",
          storeImg9: "",
          storeImg10: ""
        },
        {
          storeId: 6,
          storeName: "VTEC Coffee สาขาสมุทรปราการ",
          storeAddress1: "99/222 หมู่ 7, บางบ่อ",
          storeAddress2: "สมุทรปราการ ประเทศไทย 10560",
          storeAddress3: "",
          storePhoneNo: "098-223-324",
          storeRemark: "",
          storeLatitude: 13.6007,
          storeLongitude: 100.844,
          storeImg0: "Store-6-0.png",
          storeImg1: "",
          storeImg2: "",
          storeImg3: "",
          storeImg4: "",
          storeImg5: "",
          storeImg6: "",
          storeImg7: "",
          storeImg8: "",
          storeImg9: "",
          storeImg10: ""
        },
        {
          storeId: 7,
          storeName: "VTEC Coffee ในปั๊ม By Pass ชลบุรี",
          storeAddress1: "444 ถนนบายพาส ตำบลบ้านสวน",
          storeAddress2: "อำเภอเมืองชลบุรี จังหวัด ชลบุรี 20000",
          storeAddress3: "",
          storePhoneNo: "038-452-987",
          storeRemark: "",
          storeLatitude: 13.3581,
          storeLongitude: 101.0104,
          storeImg0: "Store-7-0.png",
          storeImg1: "",
          storeImg2: "",
          storeImg3: "",
          storeImg4: "",
          storeImg5: "",
          storeImg6: "",
          storeImg7: "",
          storeImg8: "",
          storeImg9: "",
          storeImg10: ""
        },
        {
          storeId: 8,
          storeName: "VTEC Coffee สาขาเชียงใหม่ (ท่าแพ)",
          storeAddress1: "473/12 ถนนคชสาร ช้างคลาน อำเภอเมือง",
          storeAddress2: "เขตเมืองเก่า เชียงใหม่ 50200",
          storeAddress3: "",
          storePhoneNo: "053-312-563",
          storeRemark: "",
          storeLatitude: 18.7893,
          storeLongitude: 98.9936,
          storeImg0: "",
          storeImg1: "",
          storeImg2: "",
          storeImg3: "",
          storeImg4: "",
          storeImg5: "",
          storeImg6: "",
          storeImg7: "",
          storeImg8: "",
          storeImg9: "",
          storeImg10: ""
        },
        {
          storeId: 9,
          storeName: "VTEC Coffee สาขาเชียงราย",
          storeAddress1: "เลขที่ 69 หมู่ 23 บ้านสบรวก ตำบลเวียง ",
          storeAddress2: "อำเภอเชียงแสน จังหวัดเชียงราย",
          storeAddress3: "57150",
          storePhoneNo: "053-544-567",
          storeRemark: "",
          storeLatitude: 19.9052,
          storeLongitude: 99.8331,
          storeImg0: "",
          storeImg1: "",
          storeImg2: "",
          storeImg3: "",
          storeImg4: "",
          storeImg5: "",
          storeImg6: "",
          storeImg7: "",
          storeImg8: "",
          storeImg9: "",
          storeImg10: ""
        }];

      // create finalStoreList for sort by distance
      // this just clone data from store that get from api
      var finalStoreList = [];

      function initMap() {

        var destinationLocation = [];
        for(var i = 0; i < storeListFromApi.length; i++){

          var store = storeListFromApi[i];

          destinationLocation.push({
            lat: store.storeLatitude,
            lng: store.storeLongitude
          });

          finalStoreList.push({
            storeId: store.storeId,
            storeName: store.storeName,
            storeAddress1: store.storeAddress1,
            storeAddress2: store.storeAddress2,
            storeAddress3: store.storeAddress3,
            storePhoneNo: store.storePhoneNo,
            storeRemark: store.storeRemark,
            storeLatitude: store.storeLatitude,
            storeLongitude: store.storeLongitude,
            storeImg0: store.storeImg0,
            storeImg1: store.storeImg1,
            storeImg2: store.storeImg2,
            storeImg3: store.storeImg3,
            storeImg4: store.storeImg4,
            storeImg5: store.storeImg5,
            storeImg6: store.storeImg6,
            storeImg7: store.storeImg7,
            storeImg8: store.storeImg8,
            storeImg9: store.storeImg9,
            storeImg10: store.storeImg10,
            distance: 0, // add new field for set distance from DistanceMatrixService and use in function compare
            distanceText: ""
          });
        }

        // The current location can be get from this api
        // navigator.geolocation.getCurrentPosition(function(position) {
        // var currentLocation = [{
        //   lat: position.coords.latitude,
        //   lng: position.coords.longitude
        // }];

        var currentLocations = [{
          lat: 13.841611799999999,
          lng: 100.6349315
        }];

        var service = new google.maps.DistanceMatrixService;
        service.getDistanceMatrix({
          origins: currentLocations,
          destinations: destinationLocation,
          travelMode: 'DRIVING',
          unitSystem: google.maps.UnitSystem.METRIC,
          avoidHighways: false,
          avoidTolls: false
        }, function(response, status) {
          if (status !== 'OK') {
            alert('Error was: ' + status);
          } else {
            /* json return like this
            {
              "rows": [
                {
                  "elements": [
                    {
                      "distance": {
                        "text": "17.4 กม.",
                        "value": 17400
                      },
                      "duration": {
                        "text": "25 นาที",
                        "value": 1473
                      },
                      "status": "OK"
                    },
                    {
                      "distance": {
                        "text": "7.5 กม.",
                        "value": 7508
                      },
                      "duration": {
                        "text": "12 นาที",
                        "value": 696
                      },
                      "status": "OK"
                    }
                  ]
                }
              ],
              "originAddresses": [
                "ถนน ประดิษฐ์มนูธรรม - Pradist Manudharm Rd - ทางด่วนรามอินทรา-อาจณรงค์ แขวง ลาดพร้าว เขต ลาดพร้าว กรุงเทพมหานคร 10230 ประเทศไทย"
              ],
              "destinationAddresses": [
                "1325 ถนน สุขุมวิท แขวง พระโขนงเหนือ เขต วัฒนา กรุงเทพมหานคร 10110 ประเทศไทย",
                "ซอย รามอินทรา 7 แขวง อนุสาวรีย์ เขต บางเขน กรุงเทพมหานคร 10220 ประเทศไทย"
              ]
            }
            */

            var currentLocationList = response.originAddresses;
            var destinationList = response.destinationAddresses;

            for (var i = 0; i < currentLocationList.length; i++) {
              var elements = response.rows[i].elements;
              for (var j = 0; j < elements.length; j++) {
                  finalStoreList[j].distance = elements[j].distance.value;
                  finalStoreList[j].distanceText = elements[j].distance.text;
              }
            }

            display();
          }
        });
    }

    function display(){
      var outputDiv = document.getElementById('output');
      var html = "<b>before sort</b></br>";

      for(var i = 0; i < finalStoreList.length; i++){
        var store = finalStoreList[i];
        html += store.storeName + " " + store.storeAddress1 + " " + store.storeAddress2 + "  (" + store.distanceText + ") </br>";
      }

      // sort by distance
      finalStoreList.sort(compare);

      html += "</br><b>after sort</b></br>";

      for(var i = 0; i < finalStoreList.length; i++){
        var store = finalStoreList[i];
        html += store.storeName + " " + store.storeAddress1 + " " + store.storeAddress2 + "  (" + store.distanceText + ") </br>";
      }

      outputDiv.innerHTML = html;
    }

    function compare(a, b) {
      if (a.distance < b.distance)
        return -1;
      if (a.distance > b.distance)
        return 1;
      return 0;
    }

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8IGKMUWQo5jUlPv7q9wfNOAFBHRLFlVs&callback=initMap"></script>
</body>
</html>