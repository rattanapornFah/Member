
<!DOCTYPE html>
<html lang="en" class="body-full-height" ng-app="Member">
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">

</head>
<body>

    @*  <div class="row">
        <div class="col-md-12">
            <!-- START GOOGLE WORLD MAP -->


                    <div id="map" style="width: 100%; height: 600px"></div>
                </div>
            </div>   *@
    <!-- END GOOGLE WORLD MAP-->

    <div class="row">
        <div class="col-md-8 col-sm-12 col-xs-12">

            <div ng-controller="NavigateController">


                @*<input type="text" id="txtDestination" value="" style="width: 200px" />*@
                <div class="form-group">                   
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12">Enter Destination : </label>

                            <select name="repeatSelect" id="txtDestination" ng-model="storeId">
                                <option ng-repeat="option in myWelcome" value="{{option.storeLatitude+','+option.storeLongitude}}">{{option.storeName}}</option>
                                <option value="">select</option>
                            </select>                           

                            @*<select id="txtDestination" class="form-control"  ng-model="storeId" ng-options="item.storeLatitude +item.storeLongitude  as item.storeName for item in myWelcome">
                <option value="13.7207, 100.586">VTEC Coffee สาขาเอกมัย</option>
                   <option value="">select</option>
                        <option value="13.7207, 100.586">VTEC Coffee สาขาเอกมัย</option> 
                        <option value="13.8694, 100.6064">VTEC Coffee สาขารามอินทรา</option>
                        <option value="13.7602, 100.6013">VTEC Coffee สาขาวังทองหลาง</option>
                        <option value="13.8109, 100.5586">VTEC Coffee สาขาห้าแยกลาดพร้าว</option>
                        <option value="7.0083, 100.4696">VTEC Coffee สาขาหาดใหญ่</option>
                        <option value="13.6007, 100.844">VTEC Coffee สาขาสมุทรปราการ</option>
                        <option value="13.3581, 101.0104">VTEC Coffee ในปั๊ม By Pass ชลบุรี</option>
                        <option value="18.7893, 98.9936">VTEC Coffee สาขาเชียงใหม่ (ท่าแพ)</option>
                        <option value="19.9052, 99.8331">VTEC Coffee สาขาเชียงราย</option>
            </select>*@

                            <input type="button" value="Search Route" onclick="SearchRoute()" />
                        </div>
                </div>
                

                <div id="MyMapLOC" style="width: 100%; height: 800px">
                </div>
                <div id="MapRoute" style="width: 100%; height: 800px">
                </div>

                <div id="right-panel"></div>

            </div>
        </div>
    </div>

            @*    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
                <meta charset="utf-8">
                <title>Travel modes in directions</title>  *@
            <style>
                        html, body {
                            height: 100%;
                            margin: 0;
                            padding: 0;
                        }

                        /* #map {
                    height: 100%;
                } */

                        #floating-panel {
                            position: absolute;
                            top: 10px;
                            left: 25%;
                            z-index: 5;
                            background-color: #fff;
                            padding: 5px;
                            border: 1px solid #999;
                            text-align: center;
                            font-family: 'Roboto','sans-serif';
                            line-height: 30px;
                            padding-left: 10px;
                        }
                
            </style>

            @*<div id="floating-panel">
                <b>Mode of Travel: </b>
                <select id="mode">
                    <option value="DRIVING">Driving</option>
                    <option value="WALKING">Walking</option>
                    <option value="BICYCLING">Bicycling</option>
                    <option value="TRANSIT">Transit</option>
                </select>
            </div>*@
            @*    <div id="map"></div>
                <script>
                    function initMap() {
                        var directionsDisplay = new google.maps.DirectionsRenderer;
                        var directionsService = new google.maps.DirectionsService;
                        var map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 14,
                            center: { lat: 37.77, lng: -122.447 }
                        });
                        directionsDisplay.setMap(map);

                        calculateAndDisplayRoute(directionsService, directionsDisplay);
                        document.getElementById('mode').addEventListener('change', function () {
                            calculateAndDisplayRoute(directionsService, directionsDisplay);
                        });
                    }

                    function calculateAndDisplayRoute(directionsService, directionsDisplay) {
                        var selectedMode = document.getElementById('mode').value;
                        directionsService.route({
                            origin: { lat: 13.823652, lng: 100.645871 },  // Haight.
                            destination: { lat: 13.747049, lng: 100.535410 },  // Ocean Beach.
                            // Note that Javascript allows us to access the constant
                            // using square brackets and a string value as its
                            // "property."
                            travelMode: google.maps.TravelMode[selectedMode]
                        }, function (response, status) {
                            if (status == 'OK') {
                                directionsDisplay.setDirections(response);
                            } else {
                                window.alert('Directions request failed due to ' + status);
                            }
                        });

                    }
                </script>*@


            <script type="text/javascript">

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(success);
                } else {
                    alert("There is Some Problem on your current browser to get Geo Location!");
                }

                function success(position) {
                    var lat = position.coords.latitude;
                    var long = position.coords.longitude;
                    var city = position.coords.locality;
                    var LatLng = new google.maps.LatLng(lat, long);
                    var mapOptions = {
                        center: LatLng,
                        zoom: 12,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    };

                    var map = new google.maps.Map(document.getElementById("MyMapLOC"), mapOptions);
                    var marker = new google.maps.Marker({
                        position: LatLng,
                        title: "<div style = 'height:60px;width:200px'><b>Your location:</b><br />Latitude: "
                                    + lat + +"<br />Longitude: " + long
                    });

                    marker.setMap(map);
                    var getInfoWindow = new google.maps.InfoWindow({
                        content: "<b>Your Current Location</b><br/> Latitude:" +
                                                lat + "<br /> Longitude:" + long + ""
                    });                   

                    getInfoWindow.open(map, marker);

                }
            </script>

            @*<%--Getting Route Direction From User Current Location to Destination--%> *@

    <script type="text/javascript">

        function SearchRoute() {

                    document.getElementById("MyMapLOC").style.display = 'none';

                    var markers = new Array();
                    var myLatLng;

                    //Find the current location of the user.
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function (p) {
                            var myLatLng = new google.maps.LatLng(p.coords.latitude, p.coords.longitude);
                            var m = {};
                            m.title = "Your Current Location";
                            m.lat = p.coords.latitude;
                            m.lng = p.coords.longitude;
                            markers.push(m);


                            //Find Destination address location.
                            var address = document.getElementById("txtDestination").value;
                            var geocoder = new google.maps.Geocoder();
                            geocoder.geocode({ 'address': address }, function (results, status) {
                                if (status == google.maps.GeocoderStatus.OK) {
                                    m = {};
                                    m.title = address;
                                    m.lat = results[0].geometry.location.lat();
                                    m.lng = results[0].geometry.location.lng();
                                    markers.push(m);

                                    var mapOptions = {
                                        center: myLatLng,
                                        zoom: 4,
                                        mapTypeId: google.maps.MapTypeId.ROADMAP
                                    };
                                    var map = new google.maps.Map(document.getElementById("MapRoute"), mapOptions);
                                    var infoWindow = new google.maps.InfoWindow();
                                    var lat_lng = new Array();
                                    var latlngbounds = new google.maps.LatLngBounds();

                                    for (i = 0; i < markers.length; i++) {
                                        var data = markers[i];
                                        var myLatlng = new google.maps.LatLng(data.lat, data.lng);
                                        lat_lng.push(myLatlng);
                                        var marker = new google.maps.Marker({
                                            position: myLatlng,
                                            map: map,
                                            title: data.title
                                        });
                                        latlngbounds.extend(marker.position);
                                        (function (marker, data) {
                                            google.maps.event.addListener(marker, "click", function (e) {
                                                infoWindow.setContent(data.title);
                                                infoWindow.open(map, marker);
                                            });
                                        })(marker, data);
                                    }
                                    map.setCenter(latlngbounds.getCenter());
                                    map.fitBounds(latlngbounds);

                                    //***********ROUTING****************//                                 

                                    //Initialize the Path Array.
                                    var path = new google.maps.MVCArray();

                                    //Getting the Direction Service.
                                    var service = new google.maps.DirectionsService();

                                    //Set the Path Stroke Color.
                                    var poly = new google.maps.Polyline({ map: map, strokeColor: '#4986E7' });

                                    //Loop and Draw Path Route between the Points on MAP.
                                    for (var i = 0; i < lat_lng.length; i++) {
                                        if ((i + 1) < lat_lng.length) {
                                            var src = lat_lng[i];
                                            var des = lat_lng[i + 1];
                                            path.push(src);
                                            poly.setPath(path);
                                            service.route({
                                                origin: src,
                                                destination: des,
                                                travelMode: google.maps.DirectionsTravelMode.DRIVING
                                            }, function (result, status) {
                                                if (status == google.maps.DirectionsStatus.OK) {
                                                    for (var i = 0, len = result.routes[0].overview_path.length; i < len; i++) {
                                                        path.push(result.routes[0].overview_path[i]);
                                                    }
                                                }
                                                else {
                                                    alert("Invalid location.");
                                                    window.location.href = window.location.href;
                                                }
                                            });
                                        }
                                    }                                

                                } else {
                                    alert("Request failed.")
                                }

                                
                            });

                     

  //                          $.getJSON("https://maps.googleapis.com/maps/api/directions/json?origin=13.7207,100.586&destination=13.8694,100.6064&key=AIzaSyB8IGKMUWQo5jUlPv7q9wfNOAFBHRLFlVs"
  //, function (data, status) {
  //                              console.log(data);
  //                          });


                        });
                    }
                    else {
                        alert('Some Problem in getting Geo Location.');
                        return;
                    }
        }
    </script>

    

    <script src="~/Template/vendors/jquery/dist/jquery.min.js"></script>
    <script src="~/Scripts/angular.js"></script>
    <script src="~/Scripts/angular-route.min.js"></script>
    <script src="~/Scripts/angular-sanitize.js"></script>
    <script data-require="ui-bootstrap@1.0.0" data-semver="1.0.0" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/1.0.0/ui-bootstrap-tpls.js"></script>


    <script src="~/MemberJS/app.js"></script>
            <script src="~/MemberJS/navigate.js"></script>
            <script async defer
                    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8IGKMUWQo5jUlPv7q9wfNOAFBHRLFlVs">
            </script>

            <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8IGKMUWQo5jUlPv7q9wfNOAFBHRLFlVs&libraries=places"></script>
</body>
</html>